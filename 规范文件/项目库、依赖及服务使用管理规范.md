# 项目库、依赖及服务使用管理规范

||**作者**：CYP | **联系方式**：nasDSSCYP@outlook.com |
||---|---|
|| **版本**：v1.0.0 | **最后更新**：2026年2月24日 |

---

## 文档修订记录

|| 版本 | 日期 | 修订内容 | 修订人 |
||------|------|----------|--------|
|| v1.0.0 | 2026年2月24日 | 初始版本：定义项目库、依赖及服务的选型与变更管理规范 | CYP |

---

提示：本规范以“稳定性优先、零容忍兼容性问题、所有变更可回滚”为核心原则，适用于个人开发场景下的前端/后端依赖与第三方免费服务接入，重点约束选型、引入、更新与废弃流程。

## 目录

- [1. 总则](#1-总则)
  - [1.1 目的](#11-目的)
  - [1.2 适用范围](#12-适用范围)
  - [1.3 核心原则](#13-核心原则)
  - [1.4 配置文件格式规范](#14-配置文件格式规范)
- [2. 库与依赖管理规范](#2-库与依赖管理规范)
- [3. 第三方服务使用规范](#3-第三方服务使用规范)
- [4. 免费自动测试规范（中国使用场景优化）](#4-免费自动测试规范中国使用场景优化)
- [5. 免费镜像源/加速源自动管理规范（中国优化版）](#5-免费镜像源加速源自动管理规范中国优化版)
- [6. 责任分工](#6-责任分工)
- [7. 附则](#7-附则)

## 使用说明

### 一、适配核心原则

1. 场景适配：在选型与引入依赖前，应根据项目体量与长期维护预期，优先选择社区活跃、稳定性已有验证的库，避免为短期需求引入重型依赖。
2. 最小依赖：任何功能点在满足需求的前提下，应优先选择标准库或现有依赖实现，确需新增依赖时必须证明无法复用已有能力。
3. 安全可回滚：所有依赖更新必须在具备完整回滚方案（锁版本、保留旧锁文件、可回退 Tag/Release）的前提下进行，禁止在无备份的情况下直接升级核心依赖。

### 二、落地与维护方式

1. 首次落地：在项目初始化阶段，应根据本规范确定包管理工具、锁版本策略、镜像源/加速源配置，以及“生产/开发依赖”的拆分规则。
2. 规则固化：通过锁版本文件（如 package-lock.json、go.sum）、自动检查脚本与 CI（如 npm audit、漏洞扫描）将依赖管理规则固化到流程中。
3. 文档同步：每次依赖选型或重大版本升级时，应在本规范或专门的“依赖变更记录”中记录原因、影响范围与回滚方案。

### 三、自查与培训

1. 自查频率：建议每次大版本发布或季度例行巡检时，对依赖健康度（安全、维护状态、兼容性）进行一次全面盘点。
2. 新人培训：新加入项目的开发者应了解本规范中的“选型评估维度”“升级流程”“回滚策略”等关键内容，避免随意添加依赖。
3. 工具辅助：推荐组合使用漏洞扫描工具、许可证检查工具与体积分析工具，对依赖进行持续评估。

#### 规范自查清单（库、依赖及服务使用）

为便于快速核验依赖、第三方服务及镜像源管理是否符合本规范，建议在附录中维护统一的《库、依赖及服务使用自查清单》，按项目实际适配后逐项勾选确认。

## 1. 总则

### 1.1 目的

为规范项目中库、依赖及服务的选用、接入、维护流程，**以稳定性为首要原则**，确保项目零兼容性问题、零意外中断、零回归bug，同时通过免费工具实现自动测试与镜像源/加速源优化，降低开发成本、提升研发效率，适配网页端、管理端等多端应用场景，特制定本规范。

### 1.2 适用范围

本规范适用于项目全生命周期内所有库（开源/自研）、依赖（前端/后端/跨端）、第三方服务（免费类）的选型、引入、使用、更新、废弃等管理行为，**仅适用于个人开发场景下的相关操作**。

### 1.3 核心原则

- **稳定优先原则**：所有依赖变更必须以稳定性为首要目标，宁可放弃新功能也不引入兼容性问题。任何可能影响生产环境稳定性的变更必须经过完整验证。

- **零容忍原则**：对兼容性问题的态度是零容忍。任何因依赖变更导致的bug、构建失败、运行时错误都必须彻底解决后方可上线。

- **可回滚原则**：所有依赖变更必须保留回滚能力。在变更部署前，必须验证回滚方案可行，确保出现问题能在5分钟内恢复。

- **变更最小化原则**：仅引入项目确实需要的依赖，避免不必要的依赖增加稳定性风险。

- **完全验证原则**：依赖变更前必须经过完整验证流程，任何验证不通过都必须中止变更。

### 1.4 配置文件格式规范

**所有 JSON 配置文件必须遵循以下规范**：

1. **禁止使用注释**：JSON 标准不支持注释（`//`、`/* */` 或 `#`），所有注释必须移除
2. **严格语法**：必须符合 JSON 标准语法，使用双引号、正确的逗号分隔等
3. **格式验证**：提交前必须通过 JSON 格式验证工具检查
4. **文档说明**：配置说明应记录在项目文档或代码注释中，而非配置文件中

**常见配置文件**：
- `.nancy-ignore.json` - Nancy 漏洞忽略列表（格式：JSON 字符串数组）
- `.gosec.json` - gosec 安全扫描配置
- `cspell.json` - Code Spell Checker 配置
- `package.json` - npm 包配置（支持注释，但建议避免）
- `tsconfig.json` - TypeScript 配置（支持注释，但建议避免）

**格式检查工具**：
```bash
# 使用 Node.js 验证 JSON
node -e "JSON.parse(require('fs').readFileSync('.nancy-ignore.json', 'utf8'))"

# 使用 jq 验证 JSON
jq . .nancy-ignore.json

# 使用 cspell 检查拼写
cspell "**/*.json" --config cspell.json
```

## 2. 库与依赖管理规范

### 2.1 选型标准

#### 2.1.1 快速选型参考表

| 评估维度 | 推荐标准 | 检查工具/方法 | 强制要求 |
|---------|---------|--------------|---------|
| **稳定性记录** | 近24个月无重大兼容性问题 | GitHub Issues、Changelog | **是** |
| **开源许可** | MIT、Apache 2.0、BSD | LICENSE 文件审查 | **是** |
| **社区活跃度** | 近6个月有更新，Issue响应≤7天 | GitHub Insights、npm trends | **是** |
| **下载量** | 周下载≥10万（核心依赖） | npmjs.com、npm trends | 推荐 |
| **安全漏洞** | 无高危漏洞 | npm audit、阿里云组件检测、OSV | **是** |
| **最后更新** | 12个月内有版本发布 | GitHub Releases | **是** |
| **类型定义** | TypeScript项目需有类型声明 | DefinitelyTyped、Bundlephobia | **是** |
| **包体积** | 前端单包≤100KB（压缩后） | Bundlephobia、webpack-bundle-analyzer | 推荐 |

#### 2.1.2 选型标准细则

- **稳定性第一优先**：优先选用经过充分验证、社区反馈稳定、无重大兼容性问题记录的库/依赖。重点查看 GitHub Issues 中是否有大量关于兼容性问题的报告，以及作者对兼容性问题的响应态度和处理速度。

- **长周期验证要求**：新引入的依赖应选择至少经过 6 个月以上社区验证的稳定版本，避免使用刚发布的新版本（可能存在未发现的兼容性问题）。

- **最小依赖原则**：在满足功能需求的前提下，优先选择体积小、依赖链简单、依赖项数量少的资源，避免引入冗余依赖。**单包直接依赖项不应超过 5 个，依赖链深度不应超过 3 层**。

- **明确声明兼容范围**：所选资源需在 `package.json` 中明确声明兼容的 Node.js 版本范围、浏览器版本范围，确保与项目目标运行环境完全匹配。

- **安全性强制要求**：需通过免费安全工具（如 npm audit、阿里云组件检测免费版）检测，**必须无任何高危和中危漏洞**；低危漏洞需评估风险后决定是否处理。

- **退出机制评估**：在选型阶段需评估依赖的可持续性，包括是否有明确的维护计划、是否有替代方案、迁移成本有多高，**避免使用可能突然停止维护的"僵尸库"**。

### 2.2 引入与安装流程

#### 2.2.1 引入前强制检查清单

在引入任何依赖前，必须完成以下检查，**所有检查项必须全部通过**：

| 检查项 | 检查方法 | 合格标准 | 检查结果 |
|-------|---------|---------|---------|
| **稳定性验证** | 查看近6个月 Releases 和 Issues | 无未解决的兼容性问题 | □ 通过 □ 不通过 |
| **版本兼容性** | `npm view <package> peerDependencies` | 与项目依赖无冲突 | □ 通过 □ 不通过 |
| **类型声明** | `npm view <package> types` / 查看 package.json | 有 .d.ts 或 @types 包 | □ 通过 □ 不通过 |
| **安全扫描** | `npm audit` | 无高危/中危漏洞 | □ 通过 □ 不通过 |
| **依赖数量** | `npm info <package>` | 直接依赖≤5个 | □ 通过 □ 不通过 |
| **最后更新** | `npm view <package> time` | 12个月内有更新 | □ 通过 □ 不通过 |
| **许可证** | 查看 LICENSE 文件 | MIT/Apache 2.0/BSD | □ 通过 □ 不通过 |
| **维护者信誉** | 查看 GitHub Stars、Contributors | 活跃维护、响应及时 | □ 通过 □ 不通过 |

#### 2.2.2 引入流程

1. **创建变更分支**：创建专门的变更分支进行依赖引入测试

2. **执行引入前检查**：完成上述强制检查清单，填写检查结果

3. **最小化安装测试**：在空目录中单独安装该依赖，验证其独立工作正常

4. **本地集成测试**：在项目开发环境中安装，验证与现有功能无冲突

5. **运行完整测试**：执行全部单元测试、集成测试，确保无回归

6. **性能影响评估**：对比引入前后的构建时间、包体积变化

7. **记录变更**：填写依赖变更记录（模板见 2.7.5）

8. **审核通过**：完成所有检查并通过后，方可合并到主分支

#### 2.2.3 安装规范

- 安装时必须通过项目指定的包管理工具（前端：npm/yarn/pnpm；后端：Maven/Gradle 等）

- **禁止使用模糊版本号**（如 `latest`、`*`），必须使用精确版本号

- 安装完成后，**必须**同步更新依赖锁文件并提交至代码仓库

- 安装完成后，**必须**在本地及测试环境执行完整兼容性测试

### 2.3 更新与维护

#### 2.3.1 更新策略（稳定性优先）

| 更新类型 | 是否允许自动更新 | 更新要求 | 风险等级 |
|---------|----------------|---------|---------|
| **补丁版本（Patch）** | 可自动 | 验证单元测试通过 | 低 |
| **次版本（Minor）** | 需手动确认 | 完整兼容性测试 + 人工审核 | 中 |
| **主版本（Major）** | 禁止自动 | 完整迁移方案 + 全面测试 + 人工审核 | **高** |

#### 2.3.2 更新前验证流程

**阶段一：变更分析（必做）**
```
1. 阅读 Changelog，识别所有 Breaking Changes
2. 阅读升级指南，了解迁移步骤
3. 查看 GitHub Issues，确认是否有升级导致的问题报告
4. 在独立测试环境尝试升级，观察是否有错误
5. 评估升级的收益是否大于风险
```

**阶段二：兼容性测试（必做）**
```bash
# 1. 备份当前状态
git stash
git checkout -b test/upgrade-<package>

# 2. 执行升级
npm install <package>@<new-version>

# 3. 运行类型检查
npx tsc --noEmit

# 4. 运行单元测试
npm test -- --passWithNoTests

# 5. 运行集成测试
npm run test:integration

# 6. 构建测试
npm run build

# 7. 检查依赖树
npm ls --depth=0
```

**阶段三：稳定性验证（必做）**
```
1. 在开发环境运行至少 4 小时
2. 执行所有核心业务场景
3. 测试边界情况和异常处理
4. 监控内存泄漏和性能问题
5. 测试与其他依赖的交互
```

**阶段四：决策**
| 验证结果 | 决策 |
|---------|------|
| 所有测试通过，无错误 | 可升级 |
| 有非关键问题 | 修复后升级 |
| 有关键问题或未知风险 | **中止升级**，等待修复版本 |

#### 2.后验证3.3 更新

更新完成后，需在以下环境验证稳定性：

| 环境 | 验证内容 | 通过标准 |
|-----|---------|---------|
| 开发环境 | 完整功能测试 | 100% 通过 |
| 测试环境 | 回归测试 + 集成测试 | 100% 通过 |
| 预发布环境 | 真实数据测试 | 24 小时无异常 |
| 监控验证 | 错误率、响应时间监控 | 无异常增长 |

### 2.4 废弃与移除

移除依赖前必须完成以下评估：

1. **依赖关系分析**：使用 `npm ls <package>` 分析依赖链，确认无其他依赖引用

2. **功能替代方案**：评估是否有替代方案，迁移成本有多高

3. **兼容性影响评估**：移除后对现有功能的影响范围

4. **回滚方案验证**：确认移除后可随时恢复

5. **灰度发布计划**：分阶段移除，先在开发环境验证，再逐步推进

### 2.5 依赖版本锁定规范

#### 2.5.1 版本号规范

- **生产环境强制要求**：使用精确版本号（如 `1.2.3`），禁止使用任何范围限定符

- **开发环境可酌情使用**：
  - `^1.2.3`：允许次版本和补丁版本更新
  - `~1.2.3`：仅允许补丁版本更新

- **禁止使用的写法**：
  - `latest` 或 `*`
  - 无范围限定符的版本
  - 过于宽泛的范围（如 `>=1.0.0`）

- **主版本锁定**：所有主版本更新必须手动审核，禁止自动升级

#### 2.5.2 锁文件管理

- 依赖锁文件（`package-lock.json`、`yarn.lock`、`pom.xml`）**必须**提交至代码仓库

- **禁止手动修改锁文件**，必须通过包管理工具更新

- 锁文件变更**必须**作为独立提交，便于追溯和回滚

### 2.6 兼容性稳定性保障机制

#### 2.6.1 Breaking Changes 检测规范

**引入新依赖或升级依赖时，必须检查以下 Breaking Changes**：

| 检查项 | 检查方法 | 通过标准 |
|-------|---------|---------|
| API 变更 | 阅读 Changelog、升级指南 | 无未处理的 Breaking Changes |
| 类型定义变更 | 运行 `npx tsc --noEmit` | 无类型错误 |
| 配置格式变更 | 检查项目配置文件 | 兼容现有配置 |
| 行为变化 | 运行完整测试套件 | 行为一致 |
| 依赖变化 | 检查新增依赖 | 无意外新增依赖 |
| 性能影响 | 对比性能测试结果 | 无明显性能下降 |

**发现 Breaking Changes 时的处理流程**：

1. 评估是否必须升级（是否有安全补丁必须更新）
2. 如非必须，**回滚到当前稳定版本**
3. 如必须升级，预留足够时间进行适配
4. 适配完成后，全面验证无问题方可上线

#### 2.6.2 稳定性监控规范

在生产环境中，必须监控以下指标：

| 监控项 | 告警阈值 | 处理方式 |
|-------|---------|---------|
| 构建失败率 | > 0% | 立即排查，停止部署 |
| 测试失败率 | > 1% | 修复所有失败用例 |
| 运行时错误 | 异常增加 > 10% | 立即回滚 |
| 依赖漏洞 | 任何高危/中危漏洞 | 24小时内修复 |
| 构建时间 | 增长 > 50% | 排查依赖变更 |

#### 2.6.3 异常快速响应机制

当发现依赖相关问题时，按以下流程处理：

```markdown
## 依赖问题响应流程

### 问题分级
| 级别 | 定义 | 响应时限 | 处理方式 |
|-----|-----|---------|---------|
| P0 | 生产环境完全不可用 | 5分钟 | 立即回滚，禁用依赖 |
| P1 | 核心功能异常 | 30分钟 | 紧急修复或回滚 |
| P2 | 非核心功能异常 | 4小时 | 当天修复 |
| P3 | 轻微问题 | 24小时 | 计划修复 |

### 响应步骤
1. **立即响应**（0-5分钟）
   - 确认问题影响范围
   - 通知相关人员
   - 准备回滚操作

2. **问题定位**（5-30分钟）
   - 定位到具体依赖变更
   - 分析问题原因
   - 确定修复方案

3. **修复执行**（30分钟-4小时）
   - 执行修复或回滚
   - 验证修复效果
   - 更新监控规则

4. **事后总结**（24小时内）
   - 分析根本原因
   - 更新测试用例
   - 更新依赖管理规范
```

### 2.7 依赖变更记录模板

每次依赖变更必须记录以下信息：

```markdown
## 依赖变更记录

### 基本信息
- **变更日期**：YYYY-MM-DD
- **操作人**：CYP
- **变更类型**：□ 新增  □ 升级  □ 移除

### 变更详情
| 依赖名称 | 变更前版本 | 变更后版本 | 变更原因 |
|---------|-----------|-----------|---------|
| xxx | x.x.x | x.x.x | xxx |

### 稳定性检查清单
| 检查项 | 检查结果 | 备注 |
|-------|---------|------|
| 所有单元测试通过 | □ 通过 □ 不通过 | - |
| 集成测试通过 | □ 通过 □ 不通过 | - |
| 类型检查通过 | □ 通过 □ 不通过 | - |
| 构建成功 | □ 通过 □ 不通过 | - |
| 无新增依赖 | □ 通过 □ 不通过 | - |
| 安全扫描通过 | □ 通过 □ 不通过 | - |

### 兼容性验证
| 验证项 | 结果 | 说明 |
|-------|------|------|
| Breaking Changes 检查 | ✅/❌ | - |
| API 兼容性 | ✅/❌ | - |
| 类型定义兼容性 | ✅/❌ | - |
| 行为一致性 | ✅/❌ | - |
| 性能影响 | ✅/❌ | - |

### 回滚方案
- **回滚命令**：`git checkout HEAD~1 -- package.json package-lock.json && npm install`
- **回滚验证**：运行 `npm test` 确认回滚成功
- **回滚时间**：预计 5 分钟内完成

### 最终决策
□ 合并到主分支
□ 中止变更，回滚当前分支
□ 需要进一步验证，延期处理

---

## 依赖问题记录（采坑记录）

| 日期 | 问题描述 | 影响范围 | 根本原因 | 解决方案 | 预防措施 |
|------|---------|---------|---------|---------|---------|
| YYYY-MM-DD | xxx | xxx | xxx | xxx | xxx |
```

## 3. 第三方服务使用规范

### 3.1 选型要求

- **稳定性第一**：优先选用经过长期验证、服务稳定的服务提供商，避免使用新上线或小众服务

- **版本锁定**：选择支持版本锁定的第三方服务，确保服务端版本迭代不影响项目调用兼容性

- **备用方案**：接入任何服务时，必须同时准备功能一致、接口兼容的替代服务方案

- **免费合规**：仅允许使用提供免费额度、无强制付费升级条款的第三方服务

### 3.2 接入规范

- 所有配置参数（API 密钥、接入地址）必须存储在环境变量中，**禁止硬编码**

- 敏感配置必须加密处理

- 接入完成后必须通过自动化测试验证服务可用性及接口兼容性

### 3.3 监控与告警

- 必须对第三方服务的可用性、响应速度进行实时监控

- 设置多级告警机制（邮件、企业微信、电话）

- 服务出现异常时，立即切换至备用方案

## 4. 免费自动测试规范（中国使用场景优化）

### 4.1 测试工具选型

采用全免费工具链搭建自动测试体系，**优先选用国内可访问、无跨境网络问题的工具**：

#### 4.1.1 依赖校验测试

| 工具名称 | 用途 | 国内访问 | 配置说明 |
|---------|-----|---------|---------|
| **npm audit** | 安全漏洞扫描 | ✅ 官方源/镜像源可用 | 内置支持 |
| **Snyk 免费版** | 深度安全分析 | ⚠️ 需代理或镜像 | 建议使用国内替代方案 |
| **OSV（Google）** | 漏洞数据库查询 | ⚠️ 需代理 | 可用阿里云漏洞库替代 |
| **GOVULNCHECK** | Go 漏洞检查 | ✅ 国内可用 | Go 官方工具 |
| **Nancy (GoNancy)** | Go 依赖漏洞扫描 | ✅ 国内可用 | `.nancy-ignore.json` |
| **JFrog Xray 免费版** | 依赖扫描 | ⚠️ 需代理 | 不推荐 |

**Nancy 忽略文件格式规范**：

`.nancy-ignore.json` 文件必须是有效的 JSON 格式，**不支持注释**。格式要求：

```json
[
  "CVE-2023-39325",
  "CVE-2023-44487",
  "CVE-2024-24786"
]
```

**重要提示**：
- JSON 标准不支持注释（`//` 或 `#`），所有注释必须移除
- 文件必须是有效的 JSON 数组，每个元素为 CVE 号字符串
- 忽略原因应记录在项目文档或代码注释中，而非配置文件中

**gosec 配置文件格式规范**：

`.gosec.json` 文件必须是有效的 JSON 格式，**不支持注释**。格式要求：

```json
{
  "rules": ["G101", "G102", "G103"],
  "excludes": ["\\.pb\\.go$", "_test\\.go$"],
  "confidence": 1,
  "severity": 1,
  "format": "sarif",
  "exclude-path": [".git/", "vendor/"],
  "tags": [],
  "show-stats": true
}
```

**重要提示**：
- 如果文件名是 `.json`，必须使用 JSON 格式，不能使用 YAML 格式
- 如需使用 YAML 格式，应使用 `.gosec.yml` 或 `.gosec.yaml` 作为文件名
- JSON 格式不支持注释，所有配置说明应记录在项目文档中

**中国推荐替代方案**：
- 阿里云组件检测（免费版）
- 腾讯云 T-Sec 依赖检查
- Snyk 国内镜像站点（如有）

#### 4.1.2 单元测试/集成测试

| 工具名称 | 用途 | 国内下载速度 | 推荐度 |
|---------|-----|------------|-------|
| **Jest** | 前端单元测试 | ✅ 快（淘宝源同步） | ⭐⭐⭐⭐⭐ |
| **Vitest** | 前端单元测试 | ✅ 快 | ⭐⭐⭐⭐⭐ |
| **JUnit 5** | 后端单元测试 | ✅ 快 | ⭐⭐⭐⭐⭐ |
| **pytest** | 后端单元测试 | ✅ 快 | ⭐⭐⭐⭐⭐ |

#### 4.1.3 兼容性专项测试

| 工具名称 | 用途 | 中国访问 | 替代方案 |
|---------|-----|---------|---------|
| **Playwright** | 多浏览器测试 | ✅ 官方镜像可用 | 推荐 |
| **Puppeteer** | Chrome 自动化 | ⚠️ Chrome 下载慢 | 使用 cnpm 安装 |
| **Selenium** | 浏览器自动化 | ✅ 国内可用 | 推荐 |
| **Testcontainers** | 容器化测试环境 | ✅ Docker 镜像快 | 推荐 |

#### 4.1.4 CI/CD 平台选择（中国场景）

| 平台 | 国内访问速度 | 推荐度 | 说明 |
|-----|------------|-------|------|
| **GitHub Actions** | ⚠️ 较慢 | ⭐⭐⭐ | 需配置缓存和镜像 |
| **GitLab CI** | ✅ 快 | ⭐⭐⭐⭐⭐ | 推荐国内使用 |
| **Gitee Go** | ✅ 极快 | ⭐⭐⭐⭐⭐ | 国内首选 |
| **阿里云效** | ✅ 极快 | ⭐⭐⭐⭐⭐ | 企业级推荐 |
| **腾讯云 CODING** | ✅ 极快 | ⭐⭐⭐⭐⭐ | 免费额度充足 |

### 4.2 测试执行流程

1. **本地提交前**：执行单元测试、依赖兼容性校验

2. **代码提交后**：触发全量测试（依赖校验、单元测试、集成测试、兼容性测试）

3. **测试失败**：立即排查修复，**测试不通过禁止合并**

4. **定期测试**：每周执行全量兼容性测试，覆盖多端、多环境

### 4.3 测试通过标准

| 测试类型 | 通过标准 | 备注 |
|---------|---------|------|
| 单元测试 | 100% 通过，覆盖率 ≥ 80% | - |
| 集成测试 | 100% 通过 | - |
| 类型检查 | 无错误 | - |
| 安全扫描 | 无高危/中危漏洞 | - |
| E2E 测试 | 核心流程 100% 通过 | - |

### 4.4 中国网络环境测试配置

```yaml
# .npmrc - 中国网络环境配置
registry=https://registry.npmmirror.com
# 备用源（按优先级）
# registry=https://registry.npmjs.org
# registry=https://registry.yarnpkg.com

# pnpm 配置
# pnpm config set registry https://registry.npmmirror.com

# nrm 切换命令
# nrm use taobao    # 淘宝源
# nrm use npmmirror # npmmirror 源（推荐）
# nrm use official # 官方源
```

```yaml
# GitHub Actions - 中国优化配置
name: Dependency Check (CN Optimized)

on:
  push:
    branches: [main, develop]
  pull_request:

jobs:
  dependency-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          registry-url: 'https://registry.npmmirror.com'

      - name: Configure npm mirror
        run: |
          npm config set registry https://registry.npmmirror.com
          npm config set sass_binary_site https://npmmirror.com/mirrors/node-sass
          npm config set phantomjs_cdnurl https://npmmirror.com/mirrors/phantomjs
          npm config set electron_mirror https://npmmirror.com/mirrors/electron/
          npm config set python_mirror https://npmmirror.com/mirrors/python/

      - name: Install dependencies
        run: npm ci

      - name: Security audit
        run: npm audit --audit-level=high
        continue-on-error: false

      - name: Run tests
        run: npm test
```

## 5. 免费镜像源/加速源自动管理规范（中国优化版）

### 5.1 中国可用镜像源列表

#### 5.1.1 npm/pnpm/yarn 镜像源

| 镜像源名称 | 地址 | 同步频率 | 推荐度 | 稳定性 |
|-----------|------|---------|-------|--------|
| **npmmirror（中国镜像）** | https://registry.npmmirror.com | 每小时 | ⭐⭐⭐⭐⭐ | 极佳 |
| 淘宝源 | https://registry.npmmirror.com | 每小时 | ⭐⭐⭐⭐⭐ | 极佳 |
| 腾讯云 npm | https://mirrors.cloud.tencent.com/npm/ | 每日 | ⭐⭐⭐⭐ | 良好 |
| 华为云 npm | https://repo.huaweicloud.com/repository/npm/ | 每日 | ⭐⭐⭐⭐ | 良好 |
| 官方源 | https://registry.npmjs.org | 实时 | ⭐⭐ | 慢 |

**推荐配置**：
```bash
# 永久切换到 npmmirror
npm config set registry https://registry.npmmirror.com

# 或使用 nrm 管理
nrm add npmmirror https://registry.npmmirror.com
nrm use npmmirror
```

#### 5.1.2 Python/PyPI 镜像源

| 镜像源名称 | 地址 | 推荐度 |
|-----------|------|-------|
| 清华镜像 | https://pypi.tuna.tsinghua.edu.cn/simple | ⭐⭐⭐⭐⭐ |
| 阿里云镜像 | https://mirrors.aliyun.com/pypi/simple | ⭐⭐⭐⭐⭐ |
| 腾讯云镜像 | https://mirrors.cloud.tencent.com/pypi/simple | ⭐⭐⭐⭐ |
| 华为云镜像 | https://repo.huaweicloud.com/repository/pypi/simple | ⭐⭐⭐⭐ |

**配置方法**：
```bash
# 临时使用
pip install <package> -i https://pypi.tuna.tsinghua.edu.cn/simple

# 永久配置
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 5.1.3 Go 模块镜像源

| 镜像源名称 | 地址 | 推荐度 |
|-----------|------|-------|
| 阿里云 | https://mirrors.aliyun.com/goproxy/ | ⭐⭐⭐⭐⭐ |
| 腾讯云 | https://goproxy.cn, direct | ⭐⭐⭐⭐⭐ |
| 官方代理 | https://proxy.golang.org, direct | ⭐⭐⭐ |

**配置方法**：
```bash
go env -w GOPROXY=https://goproxy.cn,direct
go env -w GOSUMDB=sum.golang.org
```

#### 5.1.4 Docker 镜像加速

| 服务商 | 地址 | 推荐度 | 说明 |
|-------|------|-------|------|
| 阿里云镜像加速 | https://<your-id>.mirror.aliyuncs.com | ⭐⭐⭐⭐⭐ | 需要账号 |
| 网易镜像加速 | https://hub-mirror.c.163.com | ⭐⭐⭐⭐ | 免费 |
| DaoCloud 镜像加速 | https://docker.m.daocloud.io | ⭐⭐⭐⭐ | 免费 |
| Docker 官方中国 | https://registry.docker-cn.com | ⭐⭐⭐ | 较少用 |

**配置方法（Docker Desktop）**：
```json
{
  "registry-mirrors": [
    "https://<your-id>.mirror.aliyuncs.com",
    "https://hub-mirror.c.163.com",
    "https://docker.m.daocloud.io"
  ]
}
```

#### 5.1.5 Git 镜像加速

| 服务 | 地址 | 推荐度 |
|-----|------|-------|
| Gitee 镜像 | https://gitee.com/ | ⭐⭐⭐⭐⭐ |
| GitCode | https://gitcode.net/ | ⭐⭐⭐⭐ |
| GitHub 代理 | https://ghproxy.com/ | ⭐⭐⭐⭐ |
| FastGit | https://hub.fastgit.org/ | ⭐⭐⭐⭐ |

**配置方法**：
```bash
# GitHub 代理加速
git config --global url."https://ghproxy.com/".insteadOf "https://github.com/"
git config --global url."https://hub.fastgit.org/".insteadOf "https://github.com/"

# 使用 Gitee 作为 GitHub 镜像
# 在 gitee.com 创建仓库，同步 GitHub 仓库
```

#### 5.1.6 Maven 镜像源

| 镜像源名称 | 地址 | 推荐度 |
|-----------|------|-------|
| 阿里云 | https://maven.aliyun.com/repository/public | ⭐⭐⭐⭐⭐ |
| 华为云 | https://repo.huaweicloud.com/repository/maven-public/ | ⭐⭐⭐⭐ |
| 腾讯云 | https://mirrors.cloud.tencent.com/repository/maven/ | ⭐⭐⭐⭐ |

**配置方法**：
```xml
<!-- settings.xml -->
<mirrors>
  <mirror>
    <id>aliyun</id>
    <mirrorOf>central</mirrorOf>
    <name>Aliyun Maven Mirror</name>
    <url>https://maven.aliyun.com/repository/public</url>
  </mirror>
</mirrors>
```

### 5.2 自动配置脚本

创建统一的中国镜像源配置脚本：

```bash
#!/bin/bash
# configure-mirrors-cn.sh - 中国镜像源自动配置脚本

echo "🚀 开始配置中国镜像源..."

# 1. 配置 npm/pnpm
echo "📦 配置 npm/pnpm 镜像源..."
npm config set registry https://registry.npmmirror.com
pnpm config set registry https://registry.npmmirror.com

# 2. 配置 Python
echo "🐍 配置 Python 镜像源..."
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 3. 配置 Go
echo "🔨 配置 Go 模块镜像源..."
go env -w GOPROXY=https://goproxy.cn,direct

# 4. 配置 Maven
echo "📚 配置 Maven 镜像源..."
cat > ~/.m2/settings.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<settings>
  <mirrors>
    <mirror>
      <id>aliyun</id>
      <mirrorOf>*</mirrorOf>
      <name>Aliyun Maven Mirror</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
</settings>
EOF

# 5. 配置 Git
echo "📝 配置 Git 镜像加速..."
git config --global url."https://ghproxy.com/".insteadOf "https://github.com/"
git config --global url."https://hub.fastgit.org/".insteadOf "https://github.com/"

echo "✅ 中国镜像源配置完成！"
echo ""
echo "📋 当前配置状态："
echo "  npm: $(npm config get registry)"
echo "  pnpm: $(pnpm config get registry)"
echo "  Go: $(go env GOPROXY)"
```

### 5.3 镜像源健康检测

定期检测镜像源可用性：

```bash
#!/bin/bash
# check-mirror-health.sh - 镜像源健康检测

MIRRORS=(
  "https://registry.npmmirror.com"
  "https://pypi.tuna.tsinghua.edu.cn"
  "https://goproxy.cn"
  "https://maven.aliyun.com/repository/public"
)

echo "🔍 检测镜像源健康状态..."
echo ""

for mirror in "${MIRRORS[@]}"; do
  status=$(curl -s -o /dev/null -w "%{http_code}" --connect-timeout 10 "$mirror" 2>/dev/null)
  if [ "$status" = "200" ]; then
    echo "✅ $mirror - 健康"
  else
    echo "❌ $mirror - 异常 (HTTP $status)"
  fi
done

echo ""
echo "📊 检测完成"
```

### 5.4 镜像源切换策略

```markdown
## 镜像源自动切换策略

### 优先级顺序
1. **首选**：npmmirror（npm/pnpm）
2. **次选**：清华镜像（Python）
3. **次选**：阿里云（Maven、Go）
4. **备用**：官方源（仅限紧急情况）

### 故障切换规则
- **检测频率**：每小时自动检测
- **故障判定**：连续 2 次超时或 HTTP 500
- **切换时间**：检测到故障后 30 秒内自动切换
- **恢复检测**：每 5 分钟检测原始源
- **自动恢复**：原始源恢复后自动切回

### 禁用场景
- 使用官方源进行版本验证时
- 调试特定版本兼容性问题时
- 官方源有特殊更新需要同步时
```

## 6. 责任分工

**个人职责**：
- 严格遵循本规范执行所有依赖管理操作
- 确保所有依赖变更经过完整验证后方可上线
- 维护自动测试用例和监控告警
- 记录所有变更及操作日志
- 保障项目全环境稳定运行

## 7. 附则

本规范自发布之日起执行，以**稳定性为核心原则**。若因业务需求、技术迭代需调整规范内容，个人可根据实际情况修订并留存修订记录。

> （注：文档部分内容可能由 AI 生成）
